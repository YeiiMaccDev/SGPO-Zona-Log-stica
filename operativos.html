<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGPO - Panel de Gestión</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <!-- Iconos Phosphor Icons -->
    <script src="https://unpkg.com/phosphor-icons"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Fondo suave */
        }
        .color-primary {
            background-color: #e53e3e; /* Rojo Tailwind 600 */
        }
        .text-primary {
            color: #e53e3e; /* Rojo Tailwind 600 */
        }
        /* Estilo para el modo de visualización de turnos */
        .schedule-grid {
            display: grid;
            grid-template-columns: 150px repeat(7, 1fr); /* Nombre + 7 días */
        }
        .schedule-day-header {
            text-align: center;
            padding: 8px 4px;
            font-size: 0.875rem;
            font-weight: 600;
            color: #4B5563;
        }
        .schedule-slot {
            height: 100%;
            min-height: 40px;
            padding: 2px;
            border-left: 1px dashed #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .shift-block {
            padding: 4px 6px;
            border-radius: 6px;
            font-size: 0.75rem;
            color: white;
            font-weight: 500;
            cursor: pointer;
            width: 90%;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }
        .shift-block:hover {
            transform: scale(1.03);
        }
        .shift-unassigned {
            cursor: pointer;
            color: #9CA3AF;
            font-size: 1.5rem;
            transition: color 0.15s;
        }
        .shift-unassigned:hover {
            color: #3B82F6; /* Azul al pasar el ratón */
        }
        /* Estilo activo de la pestaña */
        .tab-active {
            border-bottom: 3px solid #e53e3e;
            color: #e53e3e;
            font-weight: 600;
        }
        /* Estilo del modal principal */
        .modal {
            background-color: rgba(0, 0, 0, 0.6);
        }
        /* Estilo para hacer click en el KPI */
        .kpi-card {
            cursor: pointer;
            transition: all 0.2s;
        }
        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col antialiased">

    <!-- CABECERA -->
    <header class="bg-white shadow-md sticky top-0 z-20">
        <div class="container mx-auto px-4 sm:px-6 py-3 flex justify-between items-center">
            <div class="text-xl font-extrabold tracking-tight">
                <span class="text-black">SGPO</span> <span class="text-primary">Gestión</span>
            </div>
            
            <div class="flex items-center space-x-4">
                <div class="hidden sm:block text-sm text-gray-600 font-medium">
                    Gerente, <span id="userName">Sofía L.</span>
                </div>
                <div class="w-10 h-10 bg-indigo-500 rounded-full flex items-center justify-center text-lg font-bold text-white border-2 border-primary">
                    SL
                </div>
                <button 
                    id="logoutBtn"
                    class="text-gray-500 hover:text-primary transition duration-150"
                    title="Cerrar Sesión"
                    onclick="showMessageModal('Cerrar Sesión', 'Funcionalidad de Cerrar Sesión simulada.')"
                >
                    <i class="ph-bold ph-sign-out text-2xl"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="flex-grow p-4 sm:p-6 lg:p-8">
        <div class="max-w-6xl mx-auto">
            
            <!-- TÍTULO Y INFORMACIÓN RÁPIDA (KPIs de Alto Nivel) -->
            <div class="bg-white p-6 rounded-xl shadow-lg mb-6">
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-1">Panel de Control de Personal</h1>
                <p class="text-gray-500 text-sm">Resumen semanal y herramientas de programación. Haz clic en un indicador para ver el detalle.</p>
                <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- KPI 1: Total de Operativos -->
                    <div class="kpi-card bg-indigo-50 p-3 rounded-lg text-center" 
                         onclick="showKpiDetail('Total de Operativos', 'Detalle de Personal Activo', 'personal')">
                        <i class="ph-bold ph-users-three text-2xl text-indigo-600"></i>
                        <p class="text-xs text-gray-600 mt-1">Total de Operativos</p>
                        <p class="text-xl font-bold text-indigo-800">25</p>
                    </div>
                    <!-- KPI 2: Turnos Programados (Semana) -->
                    <div class="kpi-card bg-blue-50 p-3 rounded-lg text-center"
                         onclick="showKpiDetail('Turnos Programados', 'Detalle de Programación Semanal', 'turnos')">
                        <i class="ph-bold ph-calendar-blank text-2xl text-blue-600"></i>
                        <p class="text-xs text-gray-600 mt-1">Turnos Programados (Semana)</p>
                        <p class="text-xl font-bold text-blue-800">72</p>
                    </div>
                    <!-- KPI 3: Tasa de Cumplimiento -->
                    <div class="kpi-card bg-green-50 p-3 rounded-lg text-center"
                         onclick="showKpiDetail('Tasa de Cumplimiento', 'Detalle de Tiempos y Puntualidad', 'cumplimiento')">
                        <i class="ph-bold ph-chart-line-up text-2xl text-green-600"></i>
                        <p class="text-xs text-gray-600 mt-1">Tasa de Cumplimiento</p>
                        <p class="text-xl font-bold text-green-800">97.4%</p>
                    </div>
                    <!-- KPI 4: Alertas Pendientes -->
                    <div class="kpi-card bg-yellow-50 p-3 rounded-lg text-center"
                         onclick="showKpiDetail('Alertas Pendientes', 'Detalle de Novedades y Discrepancias', 'alertas')">
                        <i class="ph-bold ph-hourglass-high text-2xl text-yellow-600"></i>
                        <p class="text-xs text-gray-600 mt-1">Alertas Pendientes</p>
                        <p class="text-xl font-bold text-yellow-800">2</p>
                    </div>
                </div>
            </div>

            <!-- NAVEGACIÓN DE PESTAÑAS -->
            <div class="bg-white rounded-xl shadow-lg">
                <div class="flex border-b border-gray-200 p-2 sm:p-0">
                    <button 
                        class="tab-btn w-1/4 py-3 sm:px-6 flex justify-center items-center text-gray-600 hover:text-primary transition duration-150 tab-active" 
                        data-target="scheduling"
                    >
                        <i class="ph-bold ph-table text-xl sm:mr-2"></i> <span class="hidden sm:inline">Programación Semanal</span>
                    </button>
                    <button 
                        class="tab-btn w-1/4 py-3 sm:px-6 flex justify-center items-center text-gray-600 hover:text-primary transition duration-150" 
                        data-target="kpis"
                    >
                        <i class="ph-bold ph-chart-pie-slice text-xl sm:mr-2"></i> <span class="hidden sm:inline">Indicadores de Equipo</span>
                    </button>
                    <button 
                        class="tab-btn w-1/4 py-3 sm:px-6 flex justify-center items-center text-gray-600 hover:text-primary transition duration-150" 
                        data-target="processes"
                    >
                        <i class="ph-bold ph-list-numbers text-xl sm:mr-2"></i> <span class="hidden sm:inline">Gestión de Procesos</span>
                    </button>
                    <button 
                        class="tab-btn w-1/4 py-3 sm:px-6 flex justify-center items-center text-gray-600 hover:text-primary transition duration-150" 
                        data-target="chat"
                    >
                        <i class="ph-bold ph-chats text-xl sm:mr-2"></i> <span class="hidden sm:inline">Comunicaciones</span>
                    </button>
                </div>
                
                <!-- CONTENIDO DE LAS PESTAÑAS -->
                <div class="p-4 sm:p-6">
                    <!-- PESTAÑA 1: PROGRAMACIÓN SEMANAL -->
                    <div id="scheduling" class="tab-content">
                        <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
                            <h2 class="text-xl font-bold text-gray-800 mb-2 sm:mb-0 flex items-center">
                                <i class="ph-bold ph-calendar-check text-primary mr-2"></i> Asignación de Turnos (Semana 42)
                            </h2>
                            <button 
                                class="color-primary text-white py-2 px-4 rounded-lg text-sm hover:bg-red-700 transition duration-150 flex items-center"
                                onclick="showMessageModal('Programación Avanzada', 'Funcionalidad para generar turnos masivos o aplicar plantillas.')"
                            >
                                <i class="ph-bold ph-plus-circle text-lg mr-2"></i> Programar Masivamente
                            </button>
                        </div>
                        
                        <!-- VISUALIZADOR SEMANAL -->
                        <div class="overflow-x-auto rounded-lg border border-gray-200 shadow-inner">
                            <div id="scheduleContainer" class="schedule-grid min-w-[700px]">
                                <!-- Encabezados de Días (Inyectados por JS) -->
                            </div>
                        </div>

                        <div class="mt-4 p-3 bg-gray-50 rounded-lg text-sm text-gray-600 border border-gray-200">
                             <p><strong>Leyenda:</strong> Los colores indican el cliente o tipo de turno. Haz clic en un espacio vacío para asignar un turno.</p>
                             <div class="flex flex-wrap gap-4 mt-2">
                                <span class="flex items-center"><span class="w-3 h-3 rounded-full bg-blue-500 mr-2"></span> Distribuidora Alfa</span>
                                <span class="flex items-center"><span class="w-3 h-3 rounded-full bg-teal-500 mr-2"></span> Supermercados Beta</span>
                                <span class="flex items-center"><span class="w-3 h-3 rounded-full bg-purple-500 mr-2"></span> Comercializadora Gamma</span>
                                <span class="flex items-center"><span class="w-3 h-3 rounded-full bg-gray-400 mr-2"></span> Libre / Reserva</span>
                             </div>
                        </div>
                    </div>

                    <!-- PESTAÑA 2: INDICADORES DE EQUIPO -->
                    <div id="kpis" class="tab-content hidden">
                        <h2 class="text-xl font-bold mb-6 flex items-center text-gray-800">
                            <i class="ph-bold ph-chart-bar text-primary mr-2"></i> Indicadores Clave de Rendimiento del Equipo
                        </h2>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <!-- KPI: PUNTUALIDAD DEL EQUIPO -->
                            <div class="bg-white p-5 rounded-xl shadow border border-gray-200">
                                <p class="text-sm font-medium text-gray-600 flex items-center">
                                    <i class="ph-bold ph-timer text-xl text-green-500 mr-2"></i> Puntualidad Promedio
                                </p>
                                <p class="text-4xl font-extrabold text-green-800 mt-1">98.5%</p>
                                <p class="text-xs text-gray-500 mt-2">Puntualidad en check-in de los últimos 30 días.</p>
                            </div>
                            
                            <!-- KPI: HORAS EXTRA -->
                            <div class="bg-white p-5 rounded-xl shadow border border-gray-200">
                                <p class="text-sm font-medium text-gray-600 flex items-center">
                                    <i class="ph-bold ph-clock-counter-clockwise text-xl text-red-500 mr-2"></i> Total de Horas Extra
                                </p>
                                <p class="text-4xl font-extrabold text-red-800 mt-1">112.5 h</p>
                                <p class="text-xs text-gray-500 mt-2">Acumuladas por el equipo este mes.</p>
                            </div>

                            <!-- KPI: SATISFACCIÓN PROMEDIO -->
                            <div class="bg-white p-5 rounded-xl shadow border border-gray-200">
                                <p class="text-sm font-medium text-gray-600 flex items-center">
                                    <i class="ph-bold ph-star-fill text-xl text-yellow-500 mr-2"></i> Satisfacción (NPS)
                                </p>
                                <p class="text-4xl font-extrabold text-yellow-800 mt-1">4.6 / 5.0</p>
                                <p class="text-xs text-gray-500 mt-2">Calificación promedio de clientes en el trimestre.</p>
                            </div>
                        </div>

                        <!-- LISTADO DE BAJO RENDIMIENTO (SIMULADO) -->
                        <div class="bg-white p-6 rounded-xl shadow border border-gray-200">
                            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                                <i class="ph-bold ph-warning text-red-500 mr-2"></i> Operativos con Alertas (Última Semana)
                            </h3>
                            <ul class="space-y-3">
                                <li class="flex justify-between items-center p-3 bg-red-50 rounded-lg border border-red-200">
                                    <span class="font-medium text-red-700">Javier M. (Conductor)</span>
                                    <span class="text-sm text-red-600">2 Retrasos en Check-in</span>
                                </li>
                                <li class="flex justify-between items-center p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                                    <span class="font-medium text-yellow-700">Andrés P. (Aux. Bodega)</span>
                                    <span class="text-sm text-yellow-600">1 Reporte de Tarea Incompleta</span>
                                </li>
                            </ul>
                            <p class="text-xs text-gray-500 mt-4">Requiere revisión y seguimiento por parte del gestor.</p>
                        </div>
                    </div>

                    <!-- PESTAÑA 3: GESTIÓN DE PROCESOS -->
                    <div id="processes" class="tab-content hidden">
                        <h2 class="text-xl font-bold mb-6 flex items-center text-gray-800">
                            <i class="ph-bold ph-folder-open text-primary mr-2"></i> Documentación y Procesos Clave
                        </h2>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Enlace a Proceso 1 -->
                            <div class="bg-white p-5 rounded-xl shadow border border-gray-200 hover:bg-gray-50 transition duration-150 cursor-pointer" 
                                onclick="showMessageModal('Proceso de Nómina', 'Aquí iría la documentación sobre el Proceso de Aprobación de Nómina.')">
                                <i class="ph-bold ph-file-text text-3xl text-blue-500 mb-2"></i>
                                <h3 class="font-bold text-lg">Aprobación de Novedades de Nómina</h3>
                                <p class="text-sm text-gray-500">Revisa y aprueba las horas extra y novedades reportadas.</p>
                            </div>
                            <!-- Enlace a Proceso 2 -->
                            <div class="bg-white p-5 rounded-xl shadow border border-gray-200 hover:bg-gray-50 transition duration-150 cursor-pointer"
                                onclick="showMessageModal('Manual de SGPO', 'Aquí iría el Manual del Sistema de Gestión de Personal Operativo (SGPO).')">
                                <i class="ph-bold ph-book-open-text text-3xl text-purple-500 mb-2"></i>
                                <h3 class="font-bold text-lg">Manual de Usuario SGPO (Gestor)</h3>
                                <p class="text-sm text-gray-500">Guía completa para la utilización eficiente del sistema.</p>
                            </div>
                            <!-- Enlace a Proceso 3 -->
                            <div class="bg-white p-5 rounded-xl shadow border border-gray-200 hover:bg-gray-50 transition duration-150 cursor-pointer"
                                onclick="showMessageModal('Reporte de Incidentes', 'Aquí iría el formulario o proceso para el Reporte de Incidentes Operacionales Graves.')">
                                <i class="ph-bold ph-hazard text-3xl text-red-500 mb-2"></i>
                                <h3 class="font-bold text-lg">Reporte de Incidentes Operacionales</h3>
                                <p class="text-sm text-gray-500">Procedimiento inmediato para registrar cualquier eventualidad.</p>
                            </div>
                        </div>
                    </div>

                    <!-- PESTAÑA 4: COMUNICACIONES (CHAT SIMULADO) -->
                    <div id="chat" class="tab-content hidden">
                        <h2 class="text-xl font-bold mb-4 flex items-center text-gray-800">
                            <i class="ph-bold ph-chats text-primary mr-2"></i> Chat con Operativos y Otros Gestores
                        </h2>
                        
                        <!-- CONTENEDOR DE CONVERSACIONES -->
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <!-- Columna 1: Listado de Chats -->
                            <div class="bg-gray-50 p-3 rounded-xl border border-gray-200 h-96 overflow-y-auto sm:col-span-1">
                                <p class="text-sm font-bold text-gray-700 mb-3">Chats Recientes</p>
                                <div class="p-3 mb-2 rounded-lg bg-white shadow-sm border border-blue-200 cursor-pointer">
                                    <p class="font-semibold text-sm text-blue-800">Andrés P. <span class="text-xs text-primary ml-2">(1)</span></p>
                                    <p class="text-xs text-gray-500 truncate">RE: ¿El turno del sábado cambia?</p>
                                </div>
                                <div class="p-3 mb-2 rounded-lg bg-white shadow-sm cursor-pointer">
                                    <p class="font-semibold text-sm">Gerente de Logística</p>
                                    <p class="text-xs text-gray-500 truncate">Ok, reviso el reporte mañana.</p>
                                </div>
                                <div class="p-3 mb-2 rounded-lg bg-white shadow-sm cursor-pointer">
                                    <p class="font-semibold text-sm">Carolina J.</p>
                                    <p class="text-xs text-gray-500 truncate">El equipo 4 está fallando...</p>
                                </div>
                            </div>
                            
                            <!-- Columna 2 & 3: Ventana de Chat (Simulada) -->
                            <div class="sm:col-span-2 bg-white p-4 rounded-xl shadow-inner border border-gray-200 flex flex-col h-96">
                                <div class="flex-grow overflow-y-auto mb-4 space-y-3">
                                    <div class="flex justify-start">
                                        <div class="bg-gray-200 text-gray-800 p-3 rounded-xl rounded-tl-none max-w-xs shadow-sm">
                                            <p class="text-sm">Hola Sofía, ¿el turno de montacargas del sábado 26 sigue programado para la Sede Central?</p>
                                            <span class="text-xs text-gray-500 block text-right mt-1">10:30 AM</span>
                                        </div>
                                    </div>
                                    <div class="flex justify-end">
                                        <div class="bg-indigo-500 text-white p-3 rounded-xl rounded-tr-none max-w-xs shadow-md">
                                            <p class="text-sm">Sí, Andrés. Se mantiene igual. Te confirmo que las herramientas ya están listas.</p>
                                            <span class="text-xs text-indigo-200 block text-right mt-1">10:35 AM</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Input de Chat -->
                                <div class="flex">
                                    <input type="text" placeholder="Escribe un mensaje..." class="flex-grow p-3 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-primary focus:border-primary" />
                                    <button class="color-primary text-white p-3 rounded-r-lg hover:bg-red-700 transition duration-150" onclick="showMessageModal('Mensaje Enviado', 'Mensaje a Andrés P. simulado.')">
                                        <i class="ph-bold ph-paper-plane-right text-xl"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </main>
    
    <!-- MODAL PRINCIPAL (Para Alerts y detalles menores) -->
    <div id="messageModal" class="modal fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full mx-4 transform transition-all">
            <h3 id="modalTitle" class="text-xl font-bold mb-3 text-gray-800">Título</h3>
            <p id="modalMessage" class="text-gray-600 mb-4">Mensaje</p>
            <button 
                class="w-full color-primary text-white py-2 rounded-lg hover:bg-red-700 transition duration-150"
                onclick="document.getElementById('messageModal').classList.add('hidden')"
            >
                Aceptar
            </button>
        </div>
    </div>

    <!-- MODAL GRANDE DE DETALLE DE KPI -->
    <div id="kpiDetailModal" class="modal fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl max-w-2xl w-full mx-4 h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4 border-b pb-3">
                <h3 id="kpiModalTitle" class="text-2xl font-bold text-gray-800">Detalle del Indicador</h3>
                <button 
                    class="text-gray-400 hover:text-gray-600 text-2xl"
                    onclick="document.getElementById('kpiDetailModal').classList.add('hidden')"
                >
                    &times;
                </button>
            </div>
            <p id="kpiModalSubtitle" class="text-gray-500 mb-4"></p>
            <div id="kpiModalContent">
                <!-- Contenido detallado del KPI se inyecta aquí -->
            </div>
            <div class="mt-6">
                <button 
                    class="w-full color-primary text-white py-2 rounded-lg hover:bg-red-700 transition duration-150"
                    onclick="document.getElementById('kpiDetailModal').classList.add('hidden')"
                >
                    Cerrar Vista
                </button>
            </div>
        </div>
    </div>


    <!-- PIE DE PÁGINA -->
    <footer class="bg-white border-t border-gray-200 p-3 text-center text-xs text-gray-500 mt-4">
        <p>&copy; 2025 Zona Logística SAS | Panel de Gestión</p>
    </footer>

    <script>
        // --- Funciones de Utilidad (Reemplazo de alert) ---
        function showMessageModal(title, message) {
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalMessage').innerHTML = message;
            document.getElementById('messageModal').classList.remove('hidden');
        }

        // --- Lógica de Detalle de KPI ---

        // Mapeo de datos para el modal de detalle
        const kpiDetails = {
            personal: {
                title: 'Detalle de Personal Activo',
                subtitle: 'Listado completo y estado actual de los 25 operativos.',
                content: `
                    <p class="font-bold mb-2 text-gray-700">Resumen por Rol:</p>
                    <ul class="list-disc list-inside space-y-1 ml-4 text-sm text-gray-600 mb-4">
                        <li>Auxiliares de Bodega: 12</li>
                        <li>Conductores: 8</li>
                        <li>Montacarguistas: 5</li>
                    </ul>
                    <table class="min-w-full divide-y divide-gray-200 border rounded-lg">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nombre</th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Rol</th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Estado</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200 text-sm">
                            <tr><td class="px-3 py-2">Andrés P.</td><td class="px-3 py-2">Aux. Bodega</td><td class="px-3 py-2"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Activo</span></td></tr>
                            <tr><td class="px-3 py-2">Carolina J.</td><td class="px-3 py-2">Montacarguista</td><td class="px-3 py-2"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Activo</span></td></tr>
                            <tr><td class="px-3 py-2">Javier M.</td><td class="px-3 py-2">Conductor</td><td class="px-3 py-2"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Vacaciones</span></td></tr>
                            <tr><td class="px-3 py-2">Diana S.</td><td class="px-3 py-2">Aux. Bodega</td><td class="px-3 py-2"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Activo</span></td></tr>
                            <tr><td class="px-3 py-2">Carlos V.</td><td class="px-3 py-2">Conductor</td><td class="px-3 py-2"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Activo</span></td></tr>
                        </tbody>
                    </table>
                `
            },
            turnos: {
                title: 'Detalle de Programación Semanal',
                subtitle: 'Distribución de los 72 turnos programados esta semana por cliente y tipo.',
                content: `
                    <p class="font-bold mb-2 text-gray-700">Distribución por Cliente (Turnos):</p>
                    <div class="space-y-2 text-sm text-gray-600 mb-4">
                        <div class="flex justify-between items-center p-2 bg-blue-50 rounded-lg"><span>Distribuidora Alfa</span> <span>30 Turnos (41.7%)</span></div>
                        <div class="flex justify-between items-center p-2 bg-teal-50 rounded-lg"><span>Supermercados Beta</span> <span>25 Turnos (34.7%)</span></div>
                        <div class="flex justify-between items-center p-2 bg-purple-50 rounded-lg"><span>Comercializadora Gamma</span> <span>17 Turnos (23.6%)</span></div>
                    </div>
                    <p class="font-bold mb-2 text-gray-700">Ocupación (Horas):</p>
                    <div class="p-4 bg-gray-100 rounded-lg text-sm">
                        <p>Horas disponibles: <strong>800 h</strong></p>
                        <p>Horas programadas: <strong>576 h</strong></p>
                        <p>Tasa de Ocupación: <span class="font-bold text-blue-700">72%</span></p>
                    </div>
                `
            },
            cumplimiento: {
                title: 'Detalle de Tiempos y Puntualidad',
                subtitle: 'Análisis de la Tasa de Cumplimiento (Check-in/out) de los últimos 7 días.',
                content: `
                    <p class="font-bold mb-2 text-gray-700">Tendencia Semanal (Tasa de Puntualidad Diaria):</p>
                    <div class="space-y-2 text-sm text-gray-600 mb-4">
                        <div class="flex justify-between items-center p-2 border-b"><span>Lunes</span> <span class="font-bold text-green-700">99.1%</span></div>
                        <div class="flex justify-between items-center p-2 border-b"><span>Martes</span> <span class="font-bold text-green-700">98.5%</span></div>
                        <div class="flex justify-between items-center p-2 border-b"><span>Miércoles</span> <span class="font-bold text-red-700">95.0%</span> (Señal de Alerta)</div>
                        <div class="flex justify-between items-center p-2 border-b"><span>Jueves</span> <span class="font-bold text-green-700">97.8%</span></div>
                        <div class="flex justify-between items-center p-2 border-b"><span>Viernes</span> <span class="font-bold text-green-700">98.9%</span></div>
                        <div class="flex justify-between items-center p-2 border-b"><span>Sábado</span> <span class="font-bold text-green-700">98.0%</span></div>
                        <div class="flex justify-between items-center p-2"><span>Domingo</span> <span class="font-bold text-green-700">100%</span></div>
                    </div>
                    <p class="font-bold mb-2 text-gray-700 mt-4">Operativos con mayor impacto negativo:</p>
                    <p class="text-sm text-red-600">Javier M. (2 Retrasos), Pedro L. (1 Retraso)</p>
                `
            },
            alertas: {
                title: 'Detalle de Alertas Pendientes',
                subtitle: 'Listado de novedades que requieren la intervención o aprobación del gestor.',
                content: `
                    <p class="font-bold mb-2 text-gray-700">Novedades Pendientes de Aprobación:</p>
                    <div class="space-y-3 text-sm text-gray-800 mb-4">
                        <div class="p-3 bg-yellow-100 rounded-lg border border-yellow-300">
                            <p class="font-semibold">Alerta 1: Solicitud de Hora Extra</p>
                            <p class="text-xs text-gray-700">Operativo: Diana S. | Motivo: Carga urgente. | Horas: 2 h</p>
                            <button class="text-xs mt-1 text-blue-600 hover:underline" onclick="showMessageModal('Aprobar HE', 'Aprobación de 2 horas extra para Diana S. simulada.')">Revisar y Aprobar</button>
                        </div>
                        <div class="p-3 bg-red-100 rounded-lg border border-red-300">
                            <p class="font-semibold">Alerta 2: Discrepancia de Turno</p>
                            <p class="text-xs text-gray-700">Operativo: Andrés P. | Reporte: Turno finalizó 2 horas antes de lo programado.</p>
                            <button class="text-xs mt-1 text-blue-600 hover:underline" onclick="showMessageModal('Revisar Discrepancia', 'Ventana para conciliar la discrepancia de Andrés P. simulada.')">Investigar</button>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-4">Total de alertas resueltas hoy: 5</p>
                `
            }
        };

        function showKpiDetail(title, subtitle, kpiKey) {
            const detail = kpiDetails[kpiKey];
            if (detail) {
                document.getElementById('kpiModalTitle').innerText = title;
                document.getElementById('kpiModalSubtitle').innerText = subtitle;
                document.getElementById('kpiModalContent').innerHTML = detail.content;
                document.getElementById('kpiDetailModal').classList.remove('hidden');
            } else {
                showMessageModal('Error', 'Detalle del KPI no encontrado.');
            }
        }

        // --- Datos Simulados de Programación Semanal (Lunes = 1, Domingo = 7) ---
        const daysOfWeek = ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado", "Domingo"];
        const today = new Date();
        const startOfWeek = new Date(today.setDate(today.getDate() - today.getDay() + 1)); // Asumimos Lunes inicio de semana

        const teamSchedule = [
            { name: "Andrés P.", role: "Aux. Bodega", color: "blue", shifts: [
                { day: 1, start: "6:00", end: "14:00", client: "Alfa" },
                { day: 3, start: "8:00", end: "16:00", client: "Beta" },
                { day: 5, start: "6:00", end: "14:00", client: "Alfa" },
            ]},
            { name: "Carolina J.", role: "Montacarguista", color: "teal", shifts: [
                { day: 2, start: "7:00", end: "15:00", client: "Gamma" },
                { day: 4, start: "7:00", end: "15:00", client: "Gamma" },
                { day: 6, start: "9:00", end: "17:00", client: "Alfa" },
            ]},
            { name: "Javier M.", role: "Conductor", color: "purple", shifts: [
                { day: 1, start: "9:00", end: "17:00", client: "Beta" },
                { day: 2, start: "9:00", end: "17:00", client: "Beta" },
                { day: 3, start: "9:00", end: "17:00", client: "Beta" },
                { day: 4, start: "9:00", end: "17:00", client: "Beta" },
            ]},
            { name: "Diana S.", role: "Aux. Bodega", color: "blue", shifts: [
                { day: 5, start: "14:00", end: "22:00", client: "Gamma" },
                { day: 7, start: "8:00", end: "16:00", client: "Alfa" },
            ]},
        ];

        // --- Lógica de Programación Semanal ---

        function renderSchedule() {
            const container = document.getElementById('scheduleContainer');
            let html = '';

            // 1. Renderizar encabezados (Nombre + Días)
            html += '<div class="schedule-day-header font-bold text-black border-b border-gray-300">Operativo</div>';
            daysOfWeek.forEach((dayName, index) => {
                const date = new Date(startOfWeek);
                date.setDate(startOfWeek.getDate() + index);
                const dateString = `${date.getDate()}/${date.getMonth() + 1}`;
                html += `<div class="schedule-day-header border-b border-gray-300">${dayName}<br><span class="text-xs font-normal text-gray-500">${dateString}</span></div>`;
            });

            // 2. Renderizar filas de Operativos
            teamSchedule.forEach(operative => {
                // Columna del Operativo
                html += `<div class="p-2 border-r border-gray-200 bg-gray-50 flex flex-col justify-center text-sm font-semibold text-gray-800 min-h-[50px]">${operative.name} <span class="text-xs font-normal text-gray-500">${operative.role}</span></div>`;

                // Columnas de Turnos por Día
                for (let dayIndex = 0; dayIndex < 7; dayIndex++) {
                    const dayNumber = dayIndex + 1;
                    const shift = operative.shifts.find(s => s.day === dayNumber);
                    
                    let slotContent;
                    if (shift) {
                        // Turno Asignado
                        slotContent = `
                            <div 
                                class="shift-block bg-${operative.color}-500 hover:bg-${operative.color}-600" 
                                onclick="showShiftDetails('${operative.name}', '${daysOfWeek[dayIndex]}', '${shift.start}', '${shift.end}', '${shift.client}')"
                                title="${shift.client} (${shift.start}-${shift.end})"
                            >
                                ${shift.start} - ${shift.client.substring(0, 3)}
                            </div>
                        `;
                    } else {
                        // Slot Vacío (Clic para asignar)
                        slotContent = `
                            <button 
                                class="shift-unassigned hover:text-blue-600"
                                onclick="openAssignmentModal('${operative.name}', '${daysOfWeek[dayIndex]}', '${dayNumber}')"
                                title="Asignar Turno"
                            >
                                <i class="ph-bold ph-plus-circle"></i>
                            </button>
                        `;
                    }

                    html += `<div class="schedule-slot border-b border-gray-200">${slotContent}</div>`;
                }
            });

            container.innerHTML = html;
        }

        // Función para mostrar detalles de un turno
        function showShiftDetails(name, day, start, end, client) {
            showMessageModal(
                `Detalle del Turno`,
                `Operativo: <strong>${name}</strong><br>
                Día: <strong>${day}</strong><br>
                Horario: <strong>${start} - ${end}</strong><br>
                Cliente: <strong>${client}</strong>
                <br><br>
                <button class="bg-red-500 text-white py-1 px-3 rounded-lg text-xs mt-2" onclick="showMessageModal('Eliminar Turno', 'Funcionalidad para eliminar turno simulada.')">Eliminar</button>`
            );
        }

        // Función para abrir el modal de asignación
        function openAssignmentModal(name, day, dayNumber) {
            showMessageModal(
                `Asignar Turno a ${name}`,
                `Día: <strong>${day}</strong><br>
                <label class="block mt-3 text-sm font-medium text-gray-700">Horario (Ej: 8:00-16:00):</label>
                <input type="text" class="w-full p-2 border rounded-lg mt-1" placeholder="Ej: 07:00 - 15:00">
                <label class="block mt-3 text-sm font-medium text-gray-700">Cliente:</label>
                <select class="w-full p-2 border rounded-lg mt-1">
                    <option>Distribuidora Alfa</option>
                    <option>Supermercados Beta</option>
                    <option>Comercializadora Gamma</option>
                </select>
                <button class="bg-blue-500 text-white py-2 px-4 rounded-lg text-sm mt-4 hover:bg-blue-600 w-full" onclick="showMessageModal('Turno Creado', 'Turno creado para ${name} el ${day} (Simulación).')">
                    Confirmar Asignación
                </button>`
            );
        }

        // --- Lógica de Pestañas ---

        function setupTabs() {
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const target = button.getAttribute('data-target');

                    // Resetear clases de todos los botones
                    tabButtons.forEach(btn => btn.classList.remove('tab-active'));
                    
                    // Ocultar todos los contenidos
                    tabContents.forEach(content => content.classList.add('hidden'));

                    // Activar la pestaña y mostrar el contenido correspondiente
                    button.classList.add('tab-active');
                    document.getElementById(target).classList.remove('hidden');
                });
            });
        }

        // --- Inicialización General ---
        
        window.onload = () => {
            setupTabs();
            renderSchedule();
            // Exponer funciones al scope global
            window.showMessageModal = showMessageModal;
            window.showKpiDetail = showKpiDetail; // Nueva función expuesta
            window.showShiftDetails = showShiftDetails;
            window.openAssignmentModal = openAssignmentModal;
        };
    </script>
</body>
</html>
